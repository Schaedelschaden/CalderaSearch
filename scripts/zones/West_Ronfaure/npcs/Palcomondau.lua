-----------------------------------
-- Area: West Ronfaure
--  NPC: Palcomondau
-- Type: Patrol
-- !pos -349.796 -45.345 344.733 100
-----------------------------------
local ID = require("scripts/zones/West_Ronfaure/IDs")
require("scripts/globals/pathfind")
-----------------------------------

local path =
{
    {-192.464, -60.000, 382.392}, -- start
    {-203.815, -59.897, 381.545},
    {-219.150, -57.225, 379.947},
    {-259.700, -55.891, 378.431},
    {-282.237, -56.083, 380.621},
    {-303.025, -49.933, 383.492},
    {-311.895, -47.021, 379.100},
    {-321.987, -46.089, 380.283},
    {-338.668, -45.239, 367.705},
    {-339.992, -46.007, 361.500},
    {-348.172, -45.080, 344.165},
    {-355.982, -45.395, 341.071},
    {-358.888, -46.031, 339.800},
    {-384.022, -45.855, 337.544},
    {-396.169, -46.050, 340.124},
    {-435.300, -45.968, 339.535},
    {-464.066, -45.850, 337.503},
    {-492.519, -45.757, 339.435},
    {-499.674, -45.848, 347.074},
    {-498.518, -45.884, 379.914},
    {-500.953, -48.242, 413.020},
    {-500.491, -56.068, 438.456},
    {-500.167, -56.026, 442.085},
    {-512.689, -55.288, 458.727},
    {-519.903, -56.062, 460.446, {delay = 6}}, -- turn around
    {-512.689, -55.288, 458.727},
    {-500.167, -56.026, 442.085},
    {-500.491, -56.068, 438.456},
    {-500.953, -48.242, 413.020},
    {-498.518, -45.884, 379.914},
    {-499.674, -45.848, 347.074},
    {-492.519, -45.757, 339.435},
    {-464.066, -45.850, 337.503},
    {-435.300, -45.968, 339.535},
    {-396.169, -46.050, 340.124},
    {-384.022, -45.855, 337.544},
    {-358.888, -46.031, 339.800},
    {-355.982, -45.395, 341.071},
    {-348.172, -45.080, 344.165},
    {-339.992, -46.007, 361.500},
    {-338.668, -45.239, 367.705},
    {-321.987, -46.089, 380.283},
    {-311.895, -47.021, 379.100},
    {-303.025, -49.933, 383.492},
    {-282.237, -56.083, 380.621},
    {-259.700, -55.891, 378.431},
    {-219.150, -57.225, 379.947},
    {-203.815, -59.897, 381.545},
    {-184.176, -61.500, 382.600},
    {-180.770, -61.500, 382.600},
    {-178.300, -61.500, 382.600, {delay = 6}}, -- report
    {-184.176, -61.500, 382.600},
}

function onSpawn(npc)
    npc:initNpcPathing(path[1][1], path[1][2], path[1][3])
    onPath(npc)
    npc:setModelId(1249)
end

function onPath(npc)
    local reported = false
    npc:setModelId(1249)
    
    if npc:atPoint(path[50][1], path[50][2], path[50][3]) then
        if npc:getLocalVar("[REPORT_DONE]") == 0 then
            npc:showText(npc, ID.text.PALCOMONDAU_REPORT)
            npc:setLocalVar("[REPORT_DONE]",1)
        end 
    else
        npc:setLocalVar("[REPORT_DONE]",0)
    end
    tpz.path.general(npc, path, tpz.path.flag.WALLHACK, false)
end

function onTrade(player, npc, trade)
end

function onTrigger(player, npc)
    npc:showText(npc, ID.text.PALCOMONDAU_DIALOG)
    npc:clearTargID()
    npc:setModelId(1249)
end

function onEventUpdate(player, csid, option)
end

function onEventFinish(player, csid, option)
end